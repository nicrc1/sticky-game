<!DOCTYPE html>
<html lang="en">
<!-- ... previous head content ... -->
<script>
class Game {
    constructor() {
        // ... previous constructor content ...
        
        // Add particle system
        this.particles = [];
        this.powerupEffects = {
            pulseSize: 0,
            pulseDirection: 1,
            glowOpacity: 0.5,
            particleTimer: 0
        };
    }

    // Add this new method for particle creation
    createParticle() {
        return {
            x: this.player.x + this.player.width/2,
            y: this.player.y + this.player.height/2,
            size: Math.random() * 4 + 2,
            speedX: (Math.random() - 0.5) * 4,
            speedY: (Math.random() - 0.5) * 4,
            life: 1.0  // Will decrease over time
        };
    }

    // Add this method to update particles
    updateParticles() {
        // Create new particles when powered up
        if (this.powerupActive) {
            this.powerupEffects.particleTimer++;
            if (this.powerupEffects.particleTimer % 2 === 0) {  // Control particle creation rate
                this.particles.push(this.createParticle());
            }
        }

        // Update existing particles
        for (let i = this.particles.length - 1; i >= 0; i--) {
            const particle = this.particles[i];
            particle.x += particle.speedX;
            particle.y += particle.speedY;
            particle.life -= 0.02;  // Particle fade rate
            
            if (particle.life <= 0) {
                this.particles.splice(i, 1);
            }
        }

        // Update pulse effect
        if (this.powerupActive) {
            this.powerupEffects.pulseSize += 0.2 * this.powerupEffects.pulseDirection;
            if (this.powerupEffects.pulseSize > 5 || this.powerupEffects.pulseSize < 0) {
                this.powerupEffects.pulseDirection *= -1;
            }
            
            this.powerupEffects.glowOpacity = 0.3 + Math.sin(Date.now() / 200) * 0.2;
        }
    }

    // Modify the draw method
    draw() {
        this.ctx.clearRect(0, 0, this.width, this.height);

        // Draw platforms
        this.platforms.forEach(platform => {
            this.ctx.fillStyle = platform.type === 'breakable' ? '#ff9999' : '#66cc66';
            this.ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
        });

        // Draw power-ups
        this.powerups.forEach(powerup => {
            // Draw glow effect for power-ups
            const gradient = this.ctx.createRadialGradient(
                powerup.x + 10, powerup.y + 10, 0,
                powerup.x + 10, powerup.y + 10, 20
            );
            gradient.addColorStop(0, 'rgba(255, 64, 129, 0.8)');
            gradient.addColorStop(1, 'rgba(255, 64, 129, 0)');
            
            this.ctx.fillStyle = gradient;
            this.ctx.fillRect(powerup.x - 10, powerup.y - 10, 40, 40);
            
            this.ctx.fillStyle = '#ff4081';
            this.ctx.beginPath();
            this.ctx.arc(powerup.x + 10, powerup.y + 10, 10, 0, Math.PI * 2);
            this.ctx.fill();
        });

        // Draw particles
        this.particles.forEach(particle => {
            this.ctx.fillStyle = `rgba(255, 64, 129, ${particle.life})`;
            this.ctx.beginPath();
            this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
            this.ctx.fill();
        });

        // Draw player with effects when powered up
        if (this.powerupActive) {
            // Draw glow effect
            const gradient = this.ctx.createRadialGradient(
                this.player.x + this.player.width/2,
                this.player.y + this.player.height/2,
                0,
                this.player.x + this.player.width/2,
                this.player.y + this.player.height/2,
                this.player.width
            );
            gradient.addColorStop(0, `rgba(255, 64, 129, ${this.powerupEffects.glowOpacity})`);
            gradient.addColorStop(1, 'rgba(255, 64, 129, 0)');
            
            this.ctx.fillStyle = gradient;
            this.ctx.fillRect(
                this.player.x - 20,
                this.player.y - 20,
                this.player.width + 40,
                this.player.height + 40
            );

            // Draw pulsing outline
            this.ctx.strokeStyle = '#ff4081';
            this.ctx.lineWidth = 2;
            this.ctx.strokeRect(
                this.player.x - this.powerupEffects.pulseSize,
                this.player.y - this.powerupEffects.pulseSize,
                this.player.width + this.powerupEffects.pulseSize * 2,
                this.player.height + this.powerupEffects.pulseSize * 2
            );
        }

        // Draw player
        this.ctx.fillStyle = this.powerupActive ? '#ff4081' : '#3366ff';
        this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);

        // Add shine effect when powered up
        if (this.powerupActive) {
            this.ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            this.ctx.beginPath();
            this.ctx.moveTo(this.player.x, this.player.y);
            this.ctx.lineTo(this.player.x + 15, this.player.y);
            this.ctx.lineTo(this.player.x, this.player.y + 15);
            this.ctx.fill();
        }

        // Draw score
        this.ctx.fillStyle = '#000';
        this.ctx.font = '20px Arial';
        this.ctx.textAlign = 'left';
        this.ctx.fillText(`Score: ${this.score}`, 10, 30);
    }

    update() {
        if (this.gameOver) return;

        this.updatePowerup();
        this.updateParticles();  // Add this line to update particles

        // ... rest of the update method remains the same ...
    }

    activatePowerup() {
        this.powerupActive = true;
        this.powerupTimer = 60;
        this.player.jumpForce = this.player.baseJumpForce * 1.5;
        this.powerupEffects = {
            pulseSize: 0,
            pulseDirection: 1,
            glowOpacity: 0.5,
            particleTimer: 0
        };
        document.getElementById('powerupTimer').style.display = 'block';
    }

    // ... rest of the class remains the same ...
}
</script>
</html>
